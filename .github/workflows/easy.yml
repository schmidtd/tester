---

name: Easy Button

on:
  push:
    branches: [ dls*, main, release-* ]

  workflow_dispatch:
    inputs:
      manifest_file:
        description: 'Path to AAP manifest file'
        required: true
        default: './manifests/AAP_2.3-2023-01-31.json'
      buildref:
        description: 'Path to build reference file'
        required: true
        default: './tools/config/buildref-AAP_2.3.json'
  
jobs:
  easy:
    runs-on: ubuntu-latest
    name: easy
    permissions:
      id-token: write
      contents: read

    steps:
      # Establish snapshot datestamp
      - name: 'Do something'
        run: |
          echo "Branch: ${{ github.ref_name }}"
          echo "Event: ${{ github.event_name }}"
          echo "Manifest File: ${{ github.event.inputs.manifest_file }}"
          echo "Default Build Reference File: ${{ github.event.inputs.buildref }}"
          if [[ ${{ github.ref_name }} == release-* ]] ; 
          then 
            echo "This is a release branch"
            VERSION=`echo ${{ github.ref_name }} | awk -F"-" '{print $2}'`
            echo "Version is:" $VERSION
            BUILDREF='./tools/config/buildref-AAP_'$VERSION'.json'
          else
            echo "This is a main branch"
            BUILDREF=${{ github.event.inputs.buildref }}
          fi
          echo "BUILDREF=$BUILDREF" >> $GITHUB_ENV
          echo 'Build reference file is:' $BUILDREF
      - name: 'Do something else'
        run: |
          echo 'Buildref 1:' $BUILDREF
          echo 'Buildref 2:' ${{ env.BUILDREF }}
